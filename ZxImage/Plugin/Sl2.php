<?php
declare(strict_types=1);

namespace ZxImage\Plugin;

class Sl2 extends Nxi
{
    protected ?int $strictFileSize;

    static array $defaultNextPalette = [
        '0000000000000000',
        '0000000100000001',
        '0000001000000001',
        '0000001100000001',
        '0000010000000000',
        '0000010100000001',
        '0000011000000001',
        '0000011100000001',
        '0000100000000000',
        '0000100100000001',
        '0000101000000001',
        '0000101100000001',
        '0000110000000000',
        '0000110100000001',
        '0000111000000001',
        '0000111100000001',
        '0001000000000000',
        '0001000100000001',
        '0001001000000001',
        '0001001100000001',
        '0001010000000000',
        '0001010100000001',
        '0001011000000001',
        '0001011100000001',
        '0001100000000000',
        '0001100100000001',
        '0001101000000001',
        '0001101100000001',
        '0001110000000000',
        '0001110100000001',
        '0001111000000001',
        '0001111100000001',
        '0010000000000000',
        '0010000100000001',
        '0010001000000001',
        '0010001100000001',
        '0010010000000000',
        '0010010100000001',
        '0010011000000001',
        '0010011100000001',
        '0010100000000000',
        '0010100100000001',
        '0010101000000001',
        '0010101100000001',
        '0010110000000000',
        '0010110100000001',
        '0010111000000001',
        '0010111100000001',
        '0011000000000000',
        '0011000100000001',
        '0011001000000001',
        '0011001100000001',
        '0011010000000000',
        '0011010100000001',
        '0011011000000001',
        '0011011100000001',
        '0011100000000000',
        '0011100100000001',
        '0011101000000001',
        '0011101100000001',
        '0011110000000000',
        '0011110100000001',
        '0011111000000001',
        '0011111100000001',
        '0100000000000000',
        '0100000100000001',
        '0100001000000001',
        '0100001100000001',
        '0100010000000000',
        '0100010100000001',
        '0100011000000001',
        '0100011100000001',
        '0100100000000000',
        '0100100100000001',
        '0100101000000001',
        '0100101100000001',
        '0100110000000000',
        '0100110100000001',
        '0100111000000001',
        '0100111100000001',
        '0101000000000000',
        '0101000100000001',
        '0101001000000001',
        '0101001100000001',
        '0101010000000000',
        '0101010100000001',
        '0101011000000001',
        '0101011100000001',
        '0101100000000000',
        '0101100100000001',
        '0101101000000001',
        '0101101100000001',
        '0101110000000000',
        '0101110100000001',
        '0101111000000001',
        '0101111100000001',
        '0110000000000000',
        '0110000100000001',
        '0110001000000001',
        '0110001100000001',
        '0110010000000000',
        '0110010100000001',
        '0110011000000001',
        '0110011100000001',
        '0110100000000000',
        '0110100100000001',
        '0110101000000001',
        '0110101100000001',
        '0110110000000000',
        '0110110100000001',
        '0110111000000001',
        '0110111100000001',
        '0111000000000000',
        '0111000100000001',
        '0111001000000001',
        '0111001100000001',
        '0111010000000000',
        '0111010100000001',
        '0111011000000001',
        '0111011100000001',
        '0111100000000000',
        '0111100100000001',
        '0111101000000001',
        '0111101100000001',
        '0111110000000000',
        '0111110100000001',
        '0111111000000001',
        '0111111100000001',
        '1000000000000000',
        '1000000100000001',
        '1000001000000001',
        '1000001100000001',
        '1000010000000000',
        '1000010100000001',
        '1000011000000001',
        '1000011100000001',
        '1000100000000000',
        '1000100100000001',
        '1000101000000001',
        '1000101100000001',
        '1000110000000000',
        '1000110100000001',
        '1000111000000001',
        '1000111100000001',
        '1001000000000000',
        '1001000100000001',
        '1001001000000001',
        '1001001100000001',
        '1001010000000000',
        '1001010100000001',
        '1001011000000001',
        '1001011100000001',
        '1001100000000000',
        '1001100100000001',
        '1001101000000001',
        '1001101100000001',
        '1001110000000000',
        '1001110100000001',
        '1001111000000001',
        '1001111100000001',
        '1010000000000000',
        '1010000100000001',
        '1010001000000001',
        '1010001100000001',
        '1010010000000000',
        '1010010100000001',
        '1010011000000001',
        '1010011100000001',
        '1010100000000000',
        '1010100100000001',
        '1010101000000001',
        '1010101100000001',
        '1010110000000000',
        '1010110100000001',
        '1010111000000001',
        '1010111100000001',
        '1011000000000000',
        '1011000100000001',
        '1011001000000001',
        '1011001100000001',
        '1011010000000000',
        '1011010100000001',
        '1011011000000001',
        '1011011100000001',
        '1011100000000000',
        '1011100100000001',
        '1011101000000001',
        '1011101100000001',
        '1011110000000000',
        '1011110100000001',
        '1011111000000001',
        '1011111100000001',
        '1100000000000000',
        '1100000100000001',
        '1100001000000001',
        '1100001100000001',
        '1100010000000000',
        '1100010100000001',
        '1100011000000001',
        '1100011100000001',
        '1100100000000000',
        '1100100100000001',
        '1100101000000001',
        '1100101100000001',
        '1100110000000000',
        '1100110100000001',
        '1100111000000001',
        '1100111100000001',
        '1101000000000000',
        '1101000100000001',
        '1101001000000001',
        '1101001100000001',
        '1101010000000000',
        '1101010100000001',
        '1101011000000001',
        '1101011100000001',
        '1101100000000000',
        '1101100100000001',
        '1101101000000001',
        '1101101100000001',
        '1101110000000000',
        '1101110100000001',
        '1101111000000001',
        '1101111100000001',
        '1110000000000000',
        '1110000100000001',
        '1110001000000001',
        '1110001100000001',
        '1110010000000000',
        '1110010100000001',
        '1110011000000001',
        '1110011100000001',
        '1110100000000000',
        '1110100100000001',
        '1110101000000001',
        '1110101100000001',
        '1110110000000000',
        '1110110100000001',
        '1110111000000001',
        '1110111100000001',
        '1111000000000000',
        '1111000100000001',
        '1111001000000001',
        '1111001100000001',
        '1111010000000000',
        '1111010100000001',
        '1111011000000001',
        '1111011100000001',
        '1111100000000000',
        '1111100100000001',
        '1111101000000001',
        '1111101100000001',
        '1111110000000000',
        '1111110100000001',
        '1111111000000001',
        '1111111100000001',
    ];

    protected function loadBits(): ?array
    {
        $pixelsArray = [];
        $paletteArray = [];
        if ($this->makeHandle()) {
            if ($this->strictFileSize === 49152 + 128) {
                fseek($this->handle, 128);
            }
            $pixelsArray = $this->read8BitStrings($this->width * $this->height);
            $paletteArray = self::$defaultNextPalette;
        }
        $resultBits = [
            'pixelsArray' => $pixelsArray,
            'paletteArray' => $paletteArray,
        ];
        return $resultBits;
    }
}
